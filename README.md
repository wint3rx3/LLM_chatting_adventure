# 서울 2033 파쿠리 게임 - LLM 기반 채팅 어드벤처

서울 2033의 게임 시스템을 분석하여 만든 파쿠리 게임입니다. 핵심 차이점은 플레이어가 선택지를 클릭하는 대신, 채팅으로 자유롭게 답변하면 LLM이 이를 이해하고 가장 가까운 선택지의 결과를 처리한다는 것입니다.

## 특징

- **LLM 기반 선택지 매핑**: 플레이어의 자연어 입력을 게임 선택지로 변환
- **랜덤 인카운터 시스템**: 다양한 이벤트와 선택지
- **가젯 시스템**: 아이템, 능력, 상태 통합 관리
- **자원 관리**: 체력, 멘탈, 돈 관리
- **스토리 분기**: 플레이어 선택에 따른 다양한 경로

## 프로젝트 구조

```
.
├── src/
│   ├── game/              # 게임 엔진
│   │   ├── engine.py      # 게임 엔진 핵심
│   │   ├── encounter.py   # 인카운터 시스템
│   │   ├── gadget.py      # 가젯 시스템
│   │   ├── resource.py    # 자원 관리
│   │   └── story.py       # 스토리 분기
│   ├── llm/               # LLM 통합
│   │   └── choice_mapper.py  # 선택지 매핑
│   ├── ui/                # 사용자 인터페이스
│   │   └── chat.py        # 채팅 인터페이스
│   └── data/              # 게임 데이터
│       ├── encounters/    # 인카운터 데이터
│       ├── gadgets/       # 가젯 데이터
│       └── stories/       # 스토리 데이터
├── analysis/              # 게임 시스템 분석 문서
└── requirements.txt       # 의존성
```

## 설치 및 실행

### 1. 의존성 설치

```bash
pip install -r requirements.txt
```

### 2. 환경 변수 설정

`.env` 파일을 생성하고 [Upstage](https://console.upstage.ai/) API 키를 설정하세요:

```bash
cp .env.example .env
# .env 파일을 열어서 UPSTAGE_API_KEY를 설정하세요
```

**참고**: API 키가 없어도 게임은 실행되지만, 키워드 기반 폴백 매핑을 사용합니다.

### 3. 게임 실행

**콘솔 버전:**
```bash
python src/main.py
```

**웹 버전 (권장):**
```bash
python src/web/main.py
# 또는
uvicorn src.web.server:app --reload --host 0.0.0.0 --port 8001
```

웹 브라우저에서 `http://localhost:8001` 접속 (기본 포트)

## 게임 플레이

1. **인카운터 발생**: 게임이 시작되면 랜덤 인카운터가 발생합니다
2. **상황 확인**: 인카운터의 이름과 설명을 읽어보세요
3. **선택 입력**: 채팅창에 자신의 행동이나 선택을 자연어로 입력하세요
   - 예: "강도와 싸우겠다", "도망가자", "돈을 주고 협력하자", "설득해보자"
4. **LLM 매핑**: LLM이 입력을 분석하여 가장 적합한 선택지를 찾습니다
5. **결과 처리**: 선택지의 결과(자원 변화, 가젯 획득/손실 등)가 적용됩니다
6. **다음 인카운터**: 새로운 인카운터가 발생하고 게임이 계속됩니다

## 예시 플레이

```
==================================================
강도 만남
==================================================

어둡고 좁은 골목에서 강도를 만났습니다. 그는 칼을 들고 당신을 위협하고 있습니다.

사용 가능한 선택지 (참고):
  1. 강도와 싸운다
  2. 도망간다
  3. 돈을 주고 협력한다
  4. 강도를 설득한다

채팅창에 당신의 행동이나 선택을 입력하세요:

현재 상태:
  체력: 3/3
  멘탈: 3/3
  돈: 0/3
  보유 가젯: 근력, 날렵함

당신의 선택: 강도와 싸우겠어
```

## 프로젝트 구조

```
.
├── src/
│   ├── game/              # 게임 엔진
│   │   ├── engine.py      # 게임 엔진 핵심
│   │   ├── encounter.py   # 인카운터 시스템
│   │   ├── gadget.py      # 가젯 시스템
│   │   ├── resource.py   # 자원 관리
│   │   └── flag.py        # 플래그 관리
│   ├── llm/               # LLM 통합
│   │   └── choice_mapper.py  # 선택지 매핑
│   ├── ui/                # 사용자 인터페이스
│   │   └── chat.py        # 채팅 인터페이스
│   ├── data/              # 게임 데이터
│   │   ├── encounters/    # 인카운터 데이터
│   │   ├── gadgets/       # 가젯 데이터
│   │   └── stories/       # 스토리 데이터
│   └── main.py           # 메인 진입점
├── analysis/              # 게임 시스템 분석 문서
└── requirements.txt       # 의존성
```

## 핵심 기능

### LLM 기반 선택지 매핑 (Upstage Solar)

[Upstage Solar API](https://console.upstage.ai/api/chat)를 사용하여 플레이어의 자연어 입력을 게임의 선택지로 변환합니다. 예를 들어:
- "싸우자" → "싸운다" 선택지
- "도망가자" → "도망간다" 선택지
- "돈을 주자" → "돈을 주고 협력한다" 선택지

### 게임 시스템

- **랜덤 인카운터**: 다양한 이벤트와 상황
- **가젯 시스템**: 아이템, 능력, 상태 통합 관리
- **자원 관리**: 체력, 멘탈, 돈 (각 최대 3)
- **조건부 선택지**: 가젯/능력 보유 여부에 따라 선택지 활성화
- **스토리 분기**: 플레이어 선택에 따른 다양한 경로

## 웹 인터페이스

웹 브라우저에서 게임을 플레이할 수 있습니다:

```bash
python src/web/main.py
```

브라우저에서 `http://localhost:8000` 접속

**주요 기능:**
- 채팅 기반 게임 플레이
- 실시간 게임 상태 표시
- 반응형 디자인
- 직관적인 UI/UX

자세한 내용은 [WEB_GUIDE.md](./WEB_GUIDE.md) 참조

## 확장 가능성

- 더 많은 인카운터 추가
- 스토리 분기 시스템 구현
- 세력 시스템 추가
- 멀티플레이어 지원
- 모바일 앱 개발
